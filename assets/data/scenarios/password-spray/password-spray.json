{
    "challengeId": "password-spray",
    "title": "Password Spray Attack Detection",
    "progressiveHints": [
      {
        "level": 1,
        "title": "ðŸŽ¯ Start Simple",
        "content": "Begin by exploring the SigninLogs table. Look for authentication failures by filtering where ResultType is not equal to 0. This will show you all the failed login attempts.",
        "example": "SigninLogs | where ResultType != 0"
      },
      {
        "level": 2, 
        "title": "ðŸ“Š Group Your Data",
        "content": "Password spray attacks target multiple users from the same IP address. Use the 'summarize' operator to group failed logins by IP address and count unique users.",
        "example": "| summarize UniqueUsers = dcount(UserPrincipalName) by IPAddress"
      },
      {
        "level": 3,
        "title": "ðŸ” Add More Metrics",
        "content": "Enhance your analysis by adding total failed attempts, the list of targeted users, and time ranges. Use make_set() to collect usernames and min/max for time windows.",
        "example": "| summarize UniqueUsers = dcount(UserPrincipalName), FailedAttempts = count(), TargetedUsers = make_set(UserPrincipalName) by IPAddress"
      },
      {
        "level": 4,
        "title": "âš¡ Set Thresholds",
        "content": "Password sprays typically target 5+ users. Add a filter after your summarize to focus on suspicious activity with 'where UniqueUsers >= 5'.",
        "example": "| where UniqueUsers >= 5"
      },
      {
        "level": 5,
        "title": "ðŸŽ¯ Final Polish",
        "content": "Sort your results to show the most suspicious IPs first using 'order by UniqueUsers desc'. Also consider adding time windows and calculating attack duration for complete analysis.",
        "example": "| order by UniqueUsers desc, FailedAttempts desc"
      }
    ],
    "walkthrough": {
      "title": "ðŸ§  Password Spray Attack: KQL Detective Work",
      "subtitle": "Let's understand WHY we built this query step-by-step and how each piece solves the puzzle",
      "challenge": {
        "title": "ðŸŽ¯ The Challenge: What Makes Password Spray Attacks Tricky?",
        "description": "Password spray attacks are sneaky because:",
        "points": [
          "**Low noise per user** - Only 1-3 attempts per account (avoiding lockouts)",
          "**High user coverage** - Targets 50-100+ users with common passwords",
          "**Spread over time** - Can happen over hours/days to avoid detection",
          "**Mixed with legitimate traffic** - Blends in with normal failed logins"
        ],
        "detectiveWork": "Find patterns that show _1 source â†’ many targets â†’ systematic behavior_"
      },
      "solution": {
        "title": "ðŸ“ Our Detective Query",
        "query": "SigninLogs\n| where TimeGenerated > ago(24h)        // ðŸ• Recent activity only\n| where ResultType != 0                 // âŒ Failed logins only  \n| summarize                            // ðŸ“Š Group and analyze\n    UniqueUsers = dcount(UserPrincipalName),    // ðŸ‘¥ Count unique targets\n    FailedAttempts = count(),                   // ðŸ”¢ Total attempts\n    TargetedUsers = make_set(UserPrincipalName), // ðŸ“‹ List of victims\n    FirstAttempt = min(TimeGenerated),          // â° Attack start\n    LastAttempt = max(TimeGenerated)            // â° Attack end\n    by IPAddress, Location                      // ðŸŒ Group by source\n| where UniqueUsers >= 5               // âš ï¸ Suspicious threshold\n| extend AttackDuration = LastAttempt - FirstAttempt,  // â±ï¸ Time span\n         AverageAttemptsPerUser = FailedAttempts / UniqueUsers // ðŸ“ˆ Intensity\n| order by UniqueUsers desc, FailedAttempts desc       // ðŸ“Š Most suspicious first"
      },
      "reasoningSteps": [
        {
          "step": 1,
          "title": "Start with the Data Source",
          "operator": "SigninLogs",
          "explanation": "This table contains every authentication attempt - successful and failed. It's our goldmine of evidence.",
          "detectiveInsight": "Like reviewing security camera footage - we need to see all the attempts, not just the successes.",
          "borderColor": "#2c5aa0"
        },
        {
          "step": 2,
          "title": "Focus on Recent Activity",
          "operator": "| where TimeGenerated > ago(24h)",
          "explanation": "Password spray campaigns happen in concentrated timeframes. Old data dilutes our analysis.",
          "detectiveInsight": "Fresh crime scenes have the clearest evidence. The `ago()` function is like setting the investigation timeframe.",
          "borderColor": "#ff9800"
        },
        {
          "step": 3,
          "title": "Filter for Suspicious Activity",
          "operator": "| where ResultType != 0",
          "explanation": "Successful logins (ResultType = 0) are normal. We're hunting for patterns in the failures.",
          "detectiveInsight": "We're looking for 'attempts' not 'successes' - like studying failed break-in attempts to understand burglar patterns.",
          "borderColor": "#f44336"
        },
        {
          "step": 4,
          "title": "The Magic: Group by Attack Source",
          "operator": "| summarize ... by IPAddress, Location",
          "explanation": "This flips our perspective from 'per user' to 'per attacker' - revealing the spray pattern!",
          "detectiveInsight": "Instead of asking 'who got attacked?' we ask 'who is doing the attacking?' - this reveals systematic behavior.",
          "borderColor": "#4caf50"
        },
        {
          "step": 5,
          "title": "Count the Evidence",
          "operator": "UniqueUsers = dcount(UserPrincipalName)",
          "explanation": "`dcount()` counts unique users per IP. High numbers = spray pattern!",
          "detectiveInsight": "One person failing to login 50 times = locked out user. One IP attempting 50 different users = attacker!",
          "borderColor": "#9c27b0"
        },
        {
          "step": 6,
          "title": "Set the Trap (Threshold)",
          "operator": "| where UniqueUsers >= 5",
          "explanation": "Legitimate users rarely try 5+ different accounts. This filters out noise and focuses on systematic attacks.",
          "detectiveInsight": "This is our 'smoking gun' threshold - normal behavior vs attack behavior becomes clear.",
          "borderColor": "#795548"
        }
      ],
      "resultInterpretation": {
        "title": "ðŸŽ“ What Our Results Tell Us",
        "description": "When our query finds results, here's what each field reveals:",
        "fields": [
          {
            "field": "IPAddress + UniqueUsers â‰¥ 5",
            "meaning": "This IP is systematically targeting multiple accounts"
          },
          {
            "field": "FailedAttempts",
            "meaning": "Total volume of attack attempts from this source"
          },
          {
            "field": "TargetedUsers",
            "meaning": "Exact list of victims - helps with incident response"
          },
          {
            "field": "AttackDuration",
            "meaning": "How long the campaign lasted - indicates planning"
          },
          {
            "field": "AverageAttemptsPerUser",
            "meaning": "Intensity per victim - shows restraint to avoid lockouts"
          }
        ],
        "pattern": "Systematic, low-intensity, broad-target authentication attacks"
      }
    }
  }