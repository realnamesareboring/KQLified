<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Add this line to stop favicon 404 -->
    <link rel="icon" href="data:,">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KQL Security Training Platform</title>
    <link rel="stylesheet" href="assets/css/style.css">
    
</head>
<body>
    <header class="header">
        <div class="header-left">
            <button class="hamburger" onclick="toggleSidebar()">‚ò∞</button>
            <h1>KQL Security Training Platform</h1>
        </div>
        <div class="rank-system">
            <div class="rank-info">
                <div class="rank-title">Cyber Detective</div>
                <div class="rank-subtitle">Security Analyst</div>
            </div>
            <div class="xp-progress">
                <div class="xp-bar">
                    <div class="xp-fill"></div>
                </div>
                <div class="xp-text">750 / 2000 XP</div>
            </div>
            <!-- Recovery System Button -->
            <button class="btn btn-recovery" onclick="userManager.showRecoveryModal()" title="Progress Recovery & Certificates">
                üîê
            </button>
        </div>
    </header>

    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <!-- ========================================================================= -->
    <!-- SIMPLIFIED SIDEBAR - Navigation Generated Dynamically from JSON -->
    <!-- ========================================================================= -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">Training Modules</div>
            <div class="sidebar-subtitle">Choose your learning path</div>
        </div>

        <!-- Navigation will be generated here by navigation-generator.js -->
        <div id="dynamic-navigation">
            <!-- Platforms and challenges generated from scenarios.json -->
            <div class="navigation-loading">
                Loading training modules...
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div class="content-container">
            <!-- Overview Panel (Default) -->
            <div class="overview-panel" id="overview-panel">
                <h1 class="overview-title">Welcome to KQL Security Training</h1>
                <p class="overview-subtitle">Master threat detection and investigation across Microsoft 365, Azure, AWS, and Kubernetes environments through hands-on KQL queries and real-world scenarios.</p>
                
                <div class="stats-grid" id="stats-grid">
                    <div class="stat-card" data-stat="total-scenarios">
                        <span class="stat-number">...</span>
                        <div class="stat-label">Training Scenarios</div>
                    </div>
                    <div class="stat-card" data-stat="platforms">
                        <span class="stat-number">...</span>
                        <div class="stat-label">Cloud Platforms</div>
                    </div>
                    <div class="stat-card" data-stat="completed">
                        <span class="stat-number">...</span>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card" data-stat="xp">
                        <span class="stat-number">...</span>
                        <div class="stat-label">XP Earned</div>
                    </div>
                </div>

                <div class="platforms-overview">
                    <h2 class="platforms-title">Available Training Platforms</h2>
                    <div class="platform-cards">
                        <div class="platform-card" onclick="expandPlatform('microsoft365')">
                            <span class="platform-card-icon">üõ°Ô∏è</span>
                            <div class="platform-card-title">Microsoft 365 Security</div>
                            <div class="platform-card-desc">Learn identity protection, email security, and endpoint defense with Entra ID, Defender for Office 365, and more.</div>
                        </div>
                        <div class="platform-card" onclick="expandPlatform('azure')">
                            <span class="platform-card-icon">‚òÅÔ∏è</span>
                            <div class="platform-card-title">Azure Platform</div>
                            <div class="platform-card-desc">Master cloud security posture management, storage protection, and Azure Kubernetes Service security.</div>
                        </div>
                        <div class="platform-card" onclick="expandPlatform('aws')">
                            <span class="platform-card-icon">üèóÔ∏è</span>
                            <div class="platform-card-title">AWS Platform</div>
                            <div class="platform-card-desc">Investigate IAM compromises, S3 security issues, and advanced ransomware techniques targeting AWS services.</div>
                        </div>
                        <div class="platform-card" onclick="expandPlatform('kubernetes')">
                            <span class="platform-card-icon">üö¢</span>
                            <div class="platform-card-title">Kubernetes & Containers</div>
                            <div class="platform-card-desc">Secure container orchestration with API server protection, runtime security, and network policy enforcement.</div>
                        </div>
                        <div class="platform-card" onclick="expandPlatform('multicloud')">
                            <span class="platform-card-icon">üåê</span>
                            <div class="platform-card-title">Multi-Cloud & Hybrid</div>
                            <div class="platform-card-desc">Advanced cross-platform investigations and hybrid environment security analysis.</div>
                        </div>
                    </div>
                </div>

                <div class="getting-started">
                    <h3>üöÄ Getting Started</h3>
                    <ol>
                        <li>Click the <strong>hamburger menu (‚ò∞)</strong> to browse training scenarios</li>
                        <li>Choose a platform that matches your experience level</li>
                        <li>Start with <strong>Beginner</strong> scenarios to build foundational KQL skills</li>
                        <li>Practice writing queries in the interactive KQL workspace</li>
                        <li>Earn XP and advance your rank as you complete challenges</li>
                    </ol>
                </div>
            </div>

            <!-- Challenge Panel (Hidden by default) -->
            <div class="challenge-panel" id="challenge-panel">
                <div class="scenario-header">
                    <div class="scenario-title" id="scenario-title">Password Spray Attack Detection</div>
                    <div class="scenario-meta">
                        <div class="meta-item">
                            <span>üéØ</span>
                            <span id="scenario-platform">Microsoft Entra ID</span>
                        </div>
                        <div class="meta-item">
                            <span>üìä</span>
                            <span id="scenario-difficulty">Beginner - Intermediate</span>
                        </div>
                        <div class="meta-item">
                            <span>‚è±Ô∏è</span>
                            <span id="scenario-duration">15-20 minutes</span>
                        </div>
                        <div class="meta-item">
                            <span>üèÜ</span>
                            <span id="scenario-points">250 XP</span>
                        </div>
                    </div>
                    <div class="scenario-description" id="scenario-description">
                        <strong>Scenario:</strong> A Security Operations Center has detected unusual authentication patterns across multiple user accounts. 
                        Your task is to identify a potential password spray attack using KQL queries against Microsoft Entra ID sign-in logs. 
                        <br><br>
                        <strong>Learning Objectives:</strong> Master aggregation functions, time windows, IP address analysis, and user behavior correlation.
                        <br><br>
                        <strong>Data Sources:</strong> SigninLogs table from Microsoft Entra ID
                    </div>
                </div>

                <div class="hint-panel" id="hint-panel">
                    <div class="hint-title">
                        <span>üí°</span>
                        <span>Hint</span>
                    </div>
                    <div id="hint-content">
                        Start by filtering the SigninLogs table for failed authentication attempts (ResultType != 0). 
                        Then group by source IP address and count the number of unique users targeted.
                    </div>
                </div>

                <!-- Raw Data Logs Panel -->
                <div class="raw-logs-panel" id="raw-logs-panel">
                    <div class="logs-header">
                        <h3 style="color: #2c5aa0; margin-bottom: 1rem; font-weight: 600;">üìã SigninLogs Table - Raw Data (Last 24 Hours)</h3>
                        <p style="color: #666; font-size: 0.9rem; margin-bottom: 1.5rem;">Review the authentication logs below. Look for patterns that might indicate a password spray attack.</p>
                    </div>
                    <div class="logs-container">
                        <div class="logs-table-container">
                            <table class="logs-table">
                                <thead>
                                    <tr>
                                        <th>TimeGenerated</th>
                                        <th>UserPrincipalName</th>
                                        <th>IPAddress</th>
                                        <th>Location</th>
                                        <th>ResultType</th>
                                        <th>AppDisplayName</th>
                                        <th>ClientAppUsed</th>
                                    </tr>
                                </thead>
                                <tbody id="raw-logs-tbody">
                                    <!-- Raw log data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- KQL Workspace -->
                <div class="kql-workspace">
                    <div class="kql-toolbar">
                        <div class="kql-toolbar-left">
                            <h3 style="color: #2c5aa0; margin: 0; font-weight: 600;">üîç KQL Query Editor</h3>
                            <span style="color: #666; font-size: 0.9rem;">Write your query to analyze the authentication logs above</span>
                        </div>
                        <div class="toolbar-actions">
                            <button class="btn btn-primary" onclick="runQuery()">‚ñ∂ Run Query</button>
                            <button class="btn btn-secondary" onclick="toggleEnhancedHint()">üí° Hint</button>
                            <button class="btn btn-warning" onclick="revealSolution()">üîç Reveal Solution</button>
                        </div>
                    </div>
                    
                    <div class="kql-editor">
                        <div class="line-numbers" id="line-numbers">1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10</div>
                        <textarea class="query-editor" id="query-editor" placeholder="// Write your KQL query here
                // Example: SigninLogs | where TimeGenerated > ago(24h)"></textarea>
                    </div>
                </div>

                <div class="results-workspace" id="results-workspace" style="display: none;">
                    <div class="results-header">
                        <h3 style="color: #2c5aa0; margin: 0; font-weight: 600;">üìä Query Results</h3>
                        <span id="result-count">Ready to execute query...</span>
                    </div>
                    <div class="results-content" id="results-content">
                        Click "Run Query" to execute your KQL and see the results. The system will analyze your approach and provide feedback!
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript - Load in correct order -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="assets/js/data-loader.js"></script>
    <script src="assets/js/navigation-generator.js"></script>
    <script src="assets/js/script.js"></script>
    <script src="assets/js/user-manager.js"></script>
</body>
</html>